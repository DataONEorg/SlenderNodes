
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>d1_client_manager module &#8212; DataONE OAI-PMH Adapter 1.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-d1_client_manager">
<span id="d1-client-manager-module"></span><h1>d1_client_manager module<a class="headerlink" href="#module-d1_client_manager" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>d1_client_manager.py puts all the code managing GMN through API calls and the DataONE python library into one place. It
was written as part of an OAI-PMH based adapter, but can be incorporated into any adapter implementation.</p>
<hr class="docutils" />
<dl class="class">
<dt id="d1_client_manager.D1ClientManager">
<em class="property">class </em><code class="descclassname">d1_client_manager.</code><code class="descname">D1ClientManager</code><span class="sig-paren">(</span><em>gmn_baseurl</em>, <em>auth_cert</em>, <em>auth_cert_key</em>, <em>sysmeta_settings_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#d1_client_manager.D1ClientManager" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="d1_client_manager.D1ClientManager.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>gmn_baseurl</em>, <em>auth_cert</em>, <em>auth_cert_key</em>, <em>sysmeta_settings_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#d1_client_manager.D1ClientManager.__init__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>gmn_baseurl</strong> – The base URL configured for the Generic Member Node installation.</li>
<li><strong>auth_cert</strong> – Certificate used for authenticating with the GMN server to make changes. If the adapter script
is being run in standalone mode during development, then this will be the certificate generated by the GMN 
server’s local CA which was setup during installation of GMN. However, if this GMN instance has been registered
with a DataONE Coordinating Node environment, then the certificate provided by DataONE should be used for
authenticating with GMN.</li>
<li><strong>auth_cert_key</strong> – Also used for authentication. Similarly to the certificate described above, either a
locally generated certificate key or a DataONE provided key will be used, depending on whether this node is
still in development or is registered.</li>
<li><strong>sysmeta_settings_dict</strong> – System metadata settings which apply to every object loaded into GMN are 
configured in the main script, and then passed within a dict to be used while creating and updating objects.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="d1_client_manager.D1ClientManager.archive_science_metadata">
<code class="descname">archive_science_metadata</code><span class="sig-paren">(</span><em>current_version_pid</em><span class="sig-paren">)</span><a class="headerlink" href="#d1_client_manager.D1ClientManager.archive_science_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is called by the main adapter script to archive an existing object in GMN.When GMN is first 
populated, records which already have deleted status in the native repository will not be harvested from the 
repository into GMN. By contrast, once a record has already been created into GMN, if it later becomes deleted,
then the record will be archived in GMN.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>current_version_pid</strong> – The GMN unique identifier (pid) of the science metadata record to be archived.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if the object successfully archived or False if not. This allows the main program to track the
number of archived objects in a given run.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="d1_client_manager.D1ClientManager.check_if_identifier_exists">
<code class="descname">check_if_identifier_exists</code><span class="sig-paren">(</span><em>native_identifier_sid</em><span class="sig-paren">)</span><a class="headerlink" href="#d1_client_manager.D1ClientManager.check_if_identifier_exists" title="Permalink to this definition">¶</a></dt>
<dd><p>The main adapter script uses this function to determine if a science metadata record retrieved in an OAI-PMH
harvest already exists in GMN.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>native_identifier_sid</strong> – The native repository’s system identifier for a record harvested in an OAI-PMH
query, which is implemented as the DataONE seriesId.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if found or False if not.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="d1_client_manager.D1ClientManager.get_last_harvest_time">
<code class="descname">get_last_harvest_time</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#d1_client_manager.D1ClientManager.get_last_harvest_time" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="d1_client_manager.D1ClientManager.load_science_metadata">
<code class="descname">load_science_metadata</code><span class="sig-paren">(</span><em>sci_metadata_bytes</em>, <em>native_identifier_sid</em>, <em>record_date</em><span class="sig-paren">)</span><a class="headerlink" href="#d1_client_manager.D1ClientManager.load_science_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads a new science metadata record into GMN using the .create() method from the Member Node API.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sci_metadata_bytes</strong> – The bytes of the science metadata record as a utf-encoded string.</li>
<li><strong>native_identifier_sid</strong> – The unique identifier of the metadata record in the native repository.</li>
<li><strong>record_date</strong> – The datestamp parsed from the OAI-PMH record. This becomes the dateUploaded in GMN.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">True if the object successfully created or False if not. This allows the main program to track the
number of successfully created objects.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="d1_client_manager.D1ClientManager.update_science_metadata">
<code class="descname">update_science_metadata</code><span class="sig-paren">(</span><em>sci_metadata_bytes</em>, <em>native_identifier_sid</em>, <em>record_date</em><span class="sig-paren">)</span><a class="headerlink" href="#d1_client_manager.D1ClientManager.update_science_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>When a record is harvested from an OAI-PMH query whose native repository identifier already exists as a seriesId
in GMN, then it is understood that the record has been modified in the native repository. The .update() API
method is called to obsolete the old version of the science metadata in GMN, and load the changed record as a
new object. The .update() method automates setting the obsoletes / obsoleted by properties of both old and new 
objects in order to encode the relationship between the two, so there is no need to explicitly assign them.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sci_metadata_bytes</strong> – The bytes of the new version of the science metadata record as a utf-encoded string.</li>
<li><strong>native_identifier_sid</strong> – The identifier of the record in its native repository which is implemented as the
seriesId property in GMN.</li>
<li><strong>record_date</strong> – The datestamp parsed from the OAI-PMH record. This becomes the dateUploaded in GMN. If the
dateUploaded of the most current version of the record in GMN is the same as the datestamp of the record from
the OAI-PMH harvest, then the record hasn’t really been modified. If the datestamp from the harvest IS
different, this means something about the record as changed and it should be processed as an update in GMN.
The evaluation of whether or not a record has changed is done in the main adapter program when it calls
.check_if_identifier_exists() from d1_client_manager.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">True if the object successfully updated or False if not. This allows the main program to track the
number of updated objects in a given run.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/d1_client_manager.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Ihli.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/d1_client_manager.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>